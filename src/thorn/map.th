This is the MAP function written in Thorn!
